var ReviewDeskRouter=Backbone.Router.extend({routes:{"":"dashboard",dashboard:"dashboard",},dashboard:function(){$(".navbar-collapse .active").removeClass("active");$("#dashboardmenu").addClass("active");$("#content").html(getTemplate("dashboard",{}));this.recentReviewCollectionView=new Base_Collection_View_1({url:"/rest/reviews/recent",templateKey:"recent-reviews",individual_tag_name:"tr",postRenderCallback:function(a){}});this.recentReviewCollectionView.collection.fetch();$("#recent_user_reviews").html(this.recentReviewCollectionView.render().el)}});$(function(){try{App_reviewdesk=new ReviewDeskRouter();_reviewdesk_log(App_reviewdesk)}catch(a){window.location.reload(false);return}Backbone.history.bind("all",currentReviewDeskRoute);Backbone.history.start()});var Current_reviewDeskRoute;function currentReviewDeskRoute(a){Current_reviewDeskRoute=window.location.hash.split("#")[1];_reviewdesk_log("in reviewdesk/js : "+Current_reviewDeskRoute);try{}catch(b){}}var MD5=function(s){function L(b,a){return(b<<a)|(b>>>(32-a))}function K(k,b){var F,a,d,x,c;d=(k&2147483648);x=(b&2147483648);F=(k&1073741824);a=(b&1073741824);c=(k&1073741823)+(b&1073741823);if(F&a){return(c^2147483648^d^x)}if(F|a){if(c&1073741824){return(c^3221225472^d^x)}else{return(c^1073741824^d^x)}}else{return(c^d^x)}}function r(a,c,b){return(a&c)|((~a)&b)}function q(a,c,b){return(a&b)|(c&(~b))}function p(a,c,b){return(a^c^b)}function n(a,c,b){return(c^(a|(~b)))}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F)}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F)}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F)}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F)}function e(k){var G;var d=k.length;var c=d+8;var b=(c-(c%64))/64;var F=(b+1)*16;var H=Array(F-1);var a=0;var x=0;while(x<d){G=(x-(x%4))/4;a=(x%4)*8;H[G]=(H[G]|(k.charCodeAt(x)<<a));x++}G=(x-(x%4))/4;a=(x%4)*8;H[G]=H[G]|(128<<a);H[F-2]=d<<3;H[F-1]=d>>>29;return H}function B(c){var b="",d="",k,a;for(a=0;a<=3;a++){k=(c>>>(a*8))&255;d="0"+k.toString(16);b=b+d.substr(d.length-2,2)}return b}function J(b){b=b.replace(/\r\n/g,"\n");var a="";for(var k=0;k<b.length;k++){var d=b.charCodeAt(k);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g)}var i=B(Y)+B(X)+B(W)+B(V);return i.toLowerCase()};var LOADING_HTML='<img class="loading" style="padding-right:5px" src= "/images/loading-image.gif" />';var HANDLEBARS_COMPILED_TEMPLATES={};function getTemplate(b,c,a){if(HANDLEBARS_COMPILED_TEMPLATES[b]){return HANDLEBARS_COMPILED_TEMPLATES[b](c)}var e=$("#"+b+"-template").html();if(e){var d=Handlebars.compile(e);HANDLEBARS_COMPILED_TEMPLATES[b]=d;return d(c)}}Handlebars.registerHelper("test",function(a){alert(a)});Handlebars.registerHelper("get_gravatar_image",function(b){alert(b);if(!b){b=""}var a="https://contactuswidget.appspot.com/images/pic.png";var c="https://secure.gravatar.com/avatar/"+MD5(b)+"?d="+encodeURIComponent(a);return new Handlebars.SafeString(c)});var _reviewdesk={};_reviewdesk.debug=true;function _reviewdesk_log(a){if(!_reviewdesk||!_reviewdesk.debug){return}console.log(a)}var BaseModel=Backbone.Model.extend({});var BaseCollection=Backbone.Collection.extend({model:BaseModel,initialize:function(b,a){this.restKey=a.restKey;if(a.sortKey){this.sortKey=a.sortKey}if(a.sortDesc){this.sortDesc=a.sortDesc}},comparator:function(a){if(this.sortKey){if(!this.sortDesc){return a.get(this.sortKey)}return -a.get(this.sortKey)}return a.get("id")},parse:function(a){if(a&&a[this.restKey]){return a[this.restKey]}return a}});var Base_List_View=Backbone.View.extend({events:{"click .delete":"deleteItem","click .edit":"edit","delete-checked .agile_delete":"deleteItem",},initialize:function(){_.bindAll(this,"render","deleteItem","edit");this.model.bind("destroy",this.close,this);this.model.bind("change",this.render,this)},deleteItem:function(){this.model.destroy();this.remove()},edit:function(a){},render:function(){$(this.el).html(getTemplate(this.options.template,this.model.toJSON()));$(this.el).data(this.model);return this}});var Base_Collection_View_1=Backbone.View.extend({initialize:function(){_.bindAll(this,"render","appendItem");this.collection=new BaseCollection([],{restKey:this.options.restKey,sortKey:this.options.sortKey,sortDesc:this.options.sortDesc});this.collection.url=this.options.url;this.collection.bind("sync",this.appendItem);var b=this;this.collection.bind("reset",function(){b.render(true)});this.collection.bind("error",function(d,c){b.render(true,c.responseText)});this.render();if(this.options.cursor){this.page_size=this.options.page_size;if(!this.page_size){this.page_size=20}var b=this;this.infiniScroll=new Backbone.InfiniScroll(this.collection,{success:function(){b.render(true)},untilAttr:"cursor",param:"cursor",strict:true,pageSize:this.page_size,onFetch:function(){$("#chat-transcript").after('<div id="loading_transcripts" style="margin-left:50%"> <img src="/img/ajax-loader-cursor.gif" style="height: 11px; margin-right: 20px"></div>')}});addInfiniScrollToRoute(this.infiniScroll);var a=this.page_size;this.collection.fetch=function(c){c||(c={});c.data||(c.data={});c.data.page_size=a;return Backbone.Collection.prototype.fetch.call(this,c)}}},appendItem:function(a){if(a.get("count")){TRANSCRIPTS_COUNT=a.get("count");return}if(this.options.modelData){a.set(this.options.modelData)}var b=new Base_List_View({model:a,template:(this.options.templateKey+"-model"),tagName:this.options.individual_tag_name});$(this.model_list_element).append(b.render().el);$("#content").find("div#loading_transcripts").remove();$("#"+this.options.templateKey+"-model-list").find("tr:last").data(a)},render:function(b,a){if(b==undefined){$(this.el).html(LOADING_HTML);return this}if($(this.el).html()==LOADING_HTML){$(this.el).empty()}if(a){$(this.el).html('<div style="padding:10px;font-size:14px"><b>'+a+"<b></div>");return}$(this.el).html(getTemplate((this.options.templateKey+"-collection"),this.collection.toJSON()));if(this.collection.models.length==0){}var c=this.options.postRenderCallback;this.model_list_element=$("#"+this.options.templateKey+"-model-list",$(this.el));_(this.collection.models).each(function(d){this.appendItem(d)},this);if(c&&typeof(c)==="function"){console.log("gdhgh");c($(this.el))}if(this.page_size&&(this.collection.length<this.page_size)){this.infiniScroll.destroy()}return this}});var Base_Model_View=Backbone.View.extend({events:{"click .save":"save","click .delete":"deleteItem"},initialize:function(){_.bindAll(this,"render","save","deleteItem");if(this.options.data!=undefined){this.model=new Backbone.Model(this.options.data)}else{if(this.options.model){this.model=this.options.model}else{this.model=new Backbone.Model({})}}this.model.bind("change",this.render,this);if(this.options.url){this.model.url=this.options.url}if((!this.options.isNew)&&$.isEmptyObject(this.model.toJSON())){var a=this;this.model.fetch({success:function(b){if($.isEmptyObject(b.attributes)){a.render(true)}}})}},deleteItem:function(c){c.preventDefault();var b=this;if(this.options.template&&this.options.template!="department"){if(window.confirm("Are you sure! you want to delete this item?")){b.destroyModel(c);return}return}var a=getTemplate("delete-dept-warning");$("#verifying_agent").html(a);$("#verifying_agent").modal("show");$("#confirm-delete-department").die().live("click",function(d){d.preventDefault();$("#verifying_agent").modal("hide");b.destroyModel(d);return});return},destroyModel:function(b){b.preventDefault();var a=this;this.model.destroy({success:function(e,c){var d=a.options.navigate;if(d){if(d=="back"){window.history.back();return}Backbone.history.navigate(d,{trigger:true});return}location.reload(true)}})},save:function(f){f.preventDefault();var h=$(this.el).find("form").attr("id");var k=$("#"+h);if($(this.el).find(".save").attr("disabled")||k.find(".save").attr("disabled")){return}$("#content").find(".save").attr("disabled","disabled");k.find(".save").attr("disabled","disabled");var i,j;if($(this.el).find("form").length>1){j={};$.each($(this.el).find("form"),function(m,n){if(!isValidForm($(n))){i=false;return}var e=$(n).attr("id");var l=$(n).attr("name");if(l){j[l]=serializeForm(e)}else{$.each(serializeForm(e),function(o,p){j[o]=p})}})}if(i==false||!isValidForm(k)){$("#content").find(".save").removeAttr("disabled","disabled");k.find(".save").removeAttr("disabled","disabled");return}this.model.clear({silent:true});if(!j){j=serializeForm(h)}this.model.set(j,{silent:true});var b=this.options.navigate;var a=this.options.reload;var d=this.options.success_callback;var c=this.options.add_success_id;var g=this.options.modal;$save_info=$('<div style="display:inline-block"><img src="img/1-0.gif" height="15px" width="15px"></img></div>');$(".form-actions",this.el).append($save_info);$save_info.show();this.model.sync=function(m,l,e){return $.ajax({type:(m.toLowerCase()=="update")?"PUT":"POST",contentType:"application/x-www-form-urlencoded",beforeSend:function(n){n.setRequestHeader("X-HTTP-Method-Override","POST")},dataType:"json",data:l.toJSON(),url:l.url,success:function(o){try{showSuccessNoty("success","Your settings has been saved successfully.","top");addTagsToAgile(Current_Route)}catch(n){}if(o&&c){try{c=o.id}catch(p){}}e.success()},error:function(n){$save_info.hide();$("#content").find(".save").removeAttr("disabled","disabled");k.find(".save").removeAttr("disabled","disabled");$save_info=$('<div style="display:inline-block"><small><p style="color:#B94A48; font-size:14px"><i>'+n.responseText+"</i></p></small></div>");$(".form-actions",this.el).append($save_info);$save_info.show().delay(3000).hide(1)}})};this.model.save([],{wait:true,success:function(e){$("#content").find(".save").removeAttr("disabled","disabled");k.find(".save").removeAttr("disabled","disabled");if(a){location.reload(true)}else{if(d){d(e)}}if(b){if(b=="back"){window.history.back();return}else{if(c){b+=c}Backbone.history.navigate(b,{trigger:true});return}k.each(function(){this.reset()});if(g){$(g).modal("hide")}}else{$save_info.hide();$save_info=$('<div style="display:inline-block"><small><p class="text-success"><i>Saved Successfully</i></p></small></div>');if(h=="helpmailForm"){$save_info=$('<div style="display:inline-block"><small><p class="text-success"><i>Your request has been sent successfully</i></p></small></div>')}$(".form-actions",this.el).append($save_info);$save_info.show().delay(8000).hide(1)}},error:function(e){$(this.el).find(".save").removeAttr("disabled","disabled");k.find(".save").removeAttr("disabled","disabled");$save_info.hide();$save_info=$('<div style="display:inline-block"><small><p style="color:#B94A48; font-size:14px"><i>'+response.responseText+"</i></p></small></div>");$(".form-actions",this.el).append($save_info);$save_info.show().delay(6000).hide(1)}})},render:function(a){if((!this.model.isNew()||this.options.isNew||!$.isEmptyObject(this.model.toJSON())||a)){$(this.el).html(getTemplate(this.options.template,this.model.toJSON()));var b=this.options.postRenderCallback;if(b&&typeof(b)==="function"){b($(this.el),this.model.toJSON())}if(this.options.isNew!=true){if($(this.el).find("form").length>1){deserializeMultipleForms(this.model.toJSON(),$(this.el).find("form"))}else{if($(this.el).find("form").length==1){if(this.options.template&&(this.options.template=="macro-add-edit"||this.options.template=="automation-add-edit")&&this.model.toJSON().actions&&typeof this.model.toJSON().actions==="string"){deserializeForm(JSON.parse(this.model.toJSON().actions),$(this.el).find("form"))}else{deserializeForm(this.model.toJSON(),$(this.el).find("form"))}}}}}else{$(this.el).html(LOADING_HTML)}return this}});var INFINI_SCROLL_JSON={};function addInfiniScrollToRoute(a){var b=window.location.hash.split("#")[1];if(INFINI_SCROLL_JSON[b]){INFINI_SCROLL_JSON[b].destroy()}INFINI_SCROLL_JSON[b]=a}function activateInfiniScroll(){var a=window.location.hash.split("#")[1];$.each(INFINI_SCROLL_JSON,function(b,c){c.disableFetch()});if(INFINI_SCROLL_JSON[a]){INFINI_SCROLL_JSON[a].enableFetch()}}function deserializeForm(f,e){if(e.hasClass("alias_userids")&&f.registeredUserID!=undefined){var d=f.alias;var b=d.split(",");var a={};for(var c in b){a[c]=b[c]}f=a}$.each(f,function(k,g){var j=e.find('*[name="'+k+'"]'),m="",p="";if(j.length>0){p=j[0].tagName.toLowerCase();if(k=="or_rules"){$.each(g,function(i,q){var s=($(e).find(".or_rule"));if(i>0){var r=$(s).parent();s=$(getTemplate("or-rules-add",COMPLETE_DATA)).find("tr").clone();$(s).find("i.rule-multiple-remove").css("display","inline-block");head.js(LIB_PATH+"lib/clickdesk.jquery.chained.min.js",function(){$("#or_operations",s).chained($("#or_rules_LHS",s));$("#or_rules_RHS",s).chained($("#or_rules_LHS",s));$("#or_rules_time_based",s).chained($("#or_rules_LHS",s));$("#or_rules_time_based_value",s).chained($("#or_rules_time_based",s));$(r).append(s)})}$.each(q,function(v,w){var t=rulesDeserialize(q,s);var u=$(t).children();$.each(u,function(x,y){if($(y).attr("value")==w){$(y).attr("selected","selected");$(t).trigger("change");return}})})})}else{if(k=="and_rules"){$.each(g,function(q,r){var s=($(e).find(".and_rule"));if(q>0){var i=$(s).parent();s=$(getTemplate("and-rules-add",COMPLETE_DATA)).find("tr").clone();$(s).find("i.rule-multiple-remove").css("display","inline-block");head.js(LIB_PATH+"lib/clickdesk.jquery.chained.min.js",function(){$("#and_operations",s).chained($("#and_rules_LHS",s));$("#and_rules_RHS",s).chained($("#and_rules_LHS",s));$("#and_rules_time_based",s).chained($("#and_rules_LHS",s));$("#and_rules_time_based_value",s).chained($("#and_rules_time_based",s));$(i).append(s)})}$.each(r,function(u,v){var t=rulesDeserialize(r,s);var w=$(t).children();$.each(w,function(x,y){if($(y).attr("value")==v){$(y).attr("selected","selected");$(t).trigger("change");return}})})})}else{if(p=="select"||p=="textarea"){var l=$(j).val(g);if(j.hasClass("description")){var n=$(e,g).find("textarea").val();$(e,g).find("textarea").val(n.replace(/<br\/>/g,"\r\n"))}l}else{if(p=="input"){m=$(j[0]).attr("type");if(j.hasClass("date")){j.val(new Date(g*1000).format("mm-dd-yyyy"));j.datepicker({format:"mm-dd-yyyy",})}else{if(m=="text"||m=="password"||m=="hidden"||m=="number"){j.val(g)}else{if(p=="select"){j.val(g).trigger("change")}else{if(m=="checkbox"){if(g){if(g=="true"||g==true||g=="yes"){j.attr("checked","checked")}}}else{if(m=="radio"){j.filter('[value="'+g+'"]').attr("checked","checked")}}}}}}else{if(j.hasClass("tagsinput")&&p=="ul"&&j.attr("name")=="contacts"){$.each(g,function(q,i){var s;var r=i.id;s=getPropertyValue(i.properties,"first_name")+" "+getPropertyValue(i.properties,"last_name");$(".tagsinput",e).append('<li class="tag" data="'+r+'" class="tag"  style="display: inline-block; ">'+s+'<a class="close" id="remove_tag">&times</a></li>')})}else{if(j.hasClass("multiSelect")&&p=="ul"){$.each(g,function(i,q){$("#multipleSelect",e).multiSelect("select",q)})}else{if(j.hasClass("chainedSelect")){$.each(g,function(i,q){var s=($(e).find(".chained"))[0];if(i>0){var r=$(s).parent();s=$(getTemplate("filter-contacts",{})).find("tr").clone();$(s).find("i.filter-contacts-multiple-remove").css("display","inline-block");head.js(LIB_PATH+"lib/agile.jquery.chained.min.js",function(){$("#condition",s).chained($("#LHS",s));$("#RHS",s).chained($("#LHS",s));$("#RHS-NEW",s).chained($("#condition",s));$(r).append(s)})}$.each(q,function(t,v){var w=($(s).find('*[name="'+t+'"]').children())[0];if(w.tagName.toLowerCase()=="input"){if($(w).hasClass("date")){$(w).val(new Date(v).format("mm-dd-yyyy"));$(w).datepicker({format:"mm-dd-yyyy",});return}$(w).val(v);return}var u=$(w).children();$.each(u,function(x,y){if($(y).attr("value")==v){$(y).attr("selected","selected");$(w).trigger("change");return}})})})}else{if(j.hasClass("chainedSelect_helpdesk")){$.each(g,function(i,q){var s=($(e).find(".chained_helpdesk"))[0];if(i>0){var r=$(s).parent();s=$(getTemplate("macro-add-edit",{})).find("tr").clone();$(s).find("i.macro-multiple-remove").css("display","inline-block");head.js(LIB_PATH+"lib/clickdesk.jquery.chained.min.js",function(){$("#select_group",s).chained($("#LHS",s));$("#Middle",s).chained($("#LHS",s));$("#RHS",s).chained($("#Middle",s));$(r).append(s)})}$.each(q,function(t,v){var w=macroDeserialize(q,s);var u=$(w).children();$.each(u,function(x,y){if($(y).attr("value")==v){$(y).attr("selected","selected");$(w).trigger("change");return}})})})}else{if(j.hasClass("chainedSelect_automations")){$.each(g,function(i,q){var s=($(e).find(".automation_chained_actions"))[0];if(i>0){var r=$(s).parent();s=$(getTemplate("automation-add-edit",{})).find("#automation_actions").clone();$(s).find("i.automation-multiple-remove").css("display","inline-block");head.js(LIB_PATH+"lib/clickdesk.jquery.chained.min.js",function(){$("#select_group",s).chained($("#LHS",s));$("#Middle",s).chained($("#LHS",s));$("#RHS",s).chained($("#Middle",s));$(r).append(s)})}$.each(q,function(t,v){var w=automationDeserialize(q,s);var u=$(w).children();$.each(u,function(x,y){if($(y).attr("value")==v){$(y).attr("selected","selected");$(w).trigger("change");return}})})})}}}}}}}}}}if(e.hasClass("alias_userids")){if(g.length==0){return true}if(f.alias==g||f.registeredUserID==g){return true}var h=($(e).find(".chained-alias-userid"))[0];if(k==0){$(h).find("#aliasuserid").val(g);return true}var o=$(h).parent();h=$(getTemplate("admin-settings-alias",{})).find(".chained-alias-userid").clone();$(h).find("input[data='aliasuserid']").attr({id:"aliasuserid"+k,name:"aliasuserid"+k});$(h).find("i.aliasuserid-multiple-remove").css("display","inline-block");head.js(LIB_PATH+"lib/clickdesk.jquery.chained.min.js",function(){$(o).append(h)});$(h).find("[data='aliasuserid']").val(g)}})}function deserializeMultipleForms(b,a){$.each(a,function(c,e){var d=$(e).attr("name");if(d&&b[d]){deserializeForm(b[d],$(e))}else{deserializeForm(b,$(e))}})}function serializeForm(b){if($("#"+b+".cancel_subscription")){get_hidden_feild_values()}var a=$("#"+b).serializeArray(),d={};a=a.concat($("#"+b+" input[type=checkbox]").map(function(){return{name:this.name,value:$(this).is(":checked")}}).get());for(var c=0;c<a.length;++c){d[a[c].name]=a[c].value}return d}function isValidForm(a){jQuery.validator.addMethod("atleastThreeMonths",function(f,d){var g=$(d).siblings("select.exp_month").val(),e=f;console.log("month = "+g);var c=new Date().setFullYear(e,g-1);var b=1000*60*60*24;return this.optional(d)||(((c-new Date().getTime())/b)>90)},"Card should be atleast 3 months valid");jQuery.validator.addMethod("donotAllowComma",function(f,c){var d=$(c).val();var e=/,/g;var b=e.test(d);return this.optional(c)||(!b)},"Multiple values are not allowed");jQuery.validator.addMethod("phoneNumber",function(g,e){var f=$(e).val();var d=/^((\+)?[1-9]{1,2})?([-\s\.])?((\(\d{1,4}\))|\d{1,4})(([-\s\.])?[0-9]{1,12}){1,2}$/;var c=f.split("").length;var b=(10<=c&&c<=20&&d.test(f));return this.optional(e)||(b)},"Enter a valid Phone Number");jQuery.validator.addMethod("agentLevels",function(d,b){var c=$(b).val();return this.optional(b)||((c=="1")?true:isEnterpriseCustomer())},"This feature is available for Enterprise Plan users only. <a href='#subscribe'>Upgrade</a> now.");$(a).validate({rules:{atleastThreeMonths:true,im_id:{required:function(b){return $('[name="im_network"]').val()!="webchat"},email:{depends:function(b){return $('[name="im_network"]').val()=="gtalk"}}}},debug:true,errorElement:"span",ignore:[],errorClass:"help-inline",highlight:function(c,b){$(c).closest(".control-group").find(".controls").find("span.manual-email-validation").remove();$(c).closest(".control-group").addClass("error")},unhighlight:function(c,b){$(c).closest(".control-group").removeClass("error")},invalidHandler:function(e,c){var f=c.numberOfInvalids();var d=c.errorList;if($(this).attr("name")=="add-agent-new-form"){getAgentFormErrorTab(this,d)}if(!($(e.currentTarget).find(".form-actions #error-info").hasClass("error-info"))){var b=$('<div style="color:#B94A48; font-size:14px" class="error-info" id="error-info"><p><i>Something went wrong with your details. Please correct the errors above and try again.</p></i></div>');$(e.currentTarget).find(".form-actions").append(b);setTimeout(function(){b.remove()},8000)}}});if($(a).attr("id")=="domainSettingsForm"){if(!updateDomElement($("#domain_name"),"alphaNumeric","Only alphanumeric characters are allowed.")){return false}}return $(a).valid()}$(function(){$(".email").off().on("blur",function(a){if($(this).attr("data")=="aliasuserid"){return}return updateDomElement($(this),"email","Please enter a valid email address.")});$(".agentLevels").off().on("blur",function(a){return updateDomElement($(this),"level","This feature is available for Enterprise Plan users only. <a href='#subscribe'>Upgrade</a> now.")});$(".webChatDomainName").off().on("blur",function(a){})});function updateDomElement(g,e,d){var f=$(g).val();var b=false;var c=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,9}$/;var a=/^[a-z0-9]+$/i;if(e=="email"){b=c.test(f)}else{if(e=="level"){b=(f=="1")?true:isEnterpriseCustomer()}else{if(e=="alphaNumeric"){b=(a.test(f))}}}if(b){$(g).closest(".control-group").removeClass("error");$(g).closest(".control-group").find(".controls").find("span.manual-email-validation").remove()}else{if($(g).closest(".control-group").find(".controls").has("span.help-inline").length==0){$(g).closest(".control-group").addClass("error");if(e=="alphaNumeric"){$(g).closest(".control-group").find(".controls").append('<span for="email" generated="true" class="help-inline manual-email-validation" style="color:#df382c;">'+d+"</span>")}else{$(g).closest(".control-group").find(".controls").find("input, select").after('<span for="email" generated="true" class="help-inline manual-email-validation" style="">'+d+"</span>")}}}return b}function isEnterpriseCustomer(){try{var b=USER_BILLING_PREFS.user_plan.toLowerCase();if(b.indexOf("enterprise")==0||b.indexOf("super")==0){return true}}catch(a){}return false}function isValid(a){$("#"+a).validate();return $("#"+a).valid()}function getAgentFormErrorTab(f,e){var d=["agent_name","nick_name","email","agent_password"];var c=["im_network","im_id"];var b=["priority","max_im_bots","phone_type","phone_number"];var g=false,a=false,h=false;$.each(e,function(j,i){var k=$(i.element).attr("name");if($.inArray(k,d)!=-1){g=true}else{if($.inArray(k,c)!=-1){a=true}else{if($.inArray(k,b)!=-1){h=true}}}});if(g){$(f).find("li.agent-profile-tab").find('a[href="#agent-profile"]').trigger("click")}else{if(a){$(f).find("li.im-network-tab").find('a[href="#agent-im-network"]').trigger("click")}else{if(h){$(f).find("li.agent-advanced-tab").find('a[href="#agent-advanced"]').trigger("click")}}}};